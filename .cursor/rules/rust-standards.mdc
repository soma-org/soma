---
description: Rust Development Standards
globs: **/*.rs
---
# Rust Development Standards

Standards for writing high-quality Rust code in the Soma blockchain.

<rule>
name: rust_development_standards
description: Enforces Rust best practices for the Soma blockchain
filters:
  - type: file_extension
    pattern: "\\.rs$"

actions:
  - type: suggest
    message: |
      When developing Rust code for Soma blockchain:

      ## Code Organization
      - Follow the Actor model for component design
      - Separate business logic from I/O operations
      - Create explicit boundaries between modules
      - Use traits for abstraction and testing

      ## Async Programming
      - Use `tokio` for all async operations
      - Avoid blocking operations in async contexts
      - Use proper synchronization primitives (tokio::sync)
      - Implement graceful cancellation and shutdown

      ## Error Handling
      - Create custom error types with `thiserror`
      - Use descriptive error messages with context
      - Propagate errors with proper mapping
      - Never use unwrap() or expect() in production code

      ## Testing
      - Write unit tests for all business logic
      - Use `tokio::test` for async tests
      - Create integration tests for component interactions
      - Implement property-based tests for consensus properties

examples:
  - input: |
      // Bad error handling
      let result = operation().unwrap();
    output: |
      // Better error handling
      let result = operation()
          .map_err(|e| ModuleError::Operation(format!("Failed during operation: {}", e)))?;

  - input: |
      // Bad async test
      #[test]
      fn test_async_function() {
          let result = block_on(async_function());
          assert!(result.is_ok());
      }
    output: |
      // Better async test
      #[tokio::test]
      async fn test_async_function() {
          let result = async_function().await;
          assert!(result.is_ok());
      }

metadata:
  priority: high
  version: 1.0
</rule>